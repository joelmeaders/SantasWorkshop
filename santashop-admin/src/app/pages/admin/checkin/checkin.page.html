<ion-header>
	<ion-toolbar>
		<ion-segment
			#deviceSelection
			[value]="($deviceId | async)"
			(ionChange)="onDeviceSelectChange($event)"
			scrollable="true"
		>
			<ion-segment-button #selection [value]="''">
				None
			</ion-segment-button>
			<ion-segment-button
				*ngFor="let device of ($availableDevices | async)"
				[value]="device.deviceId"
			>
				{{ device.label.split(' (')[0] }}
			</ion-segment-button>
		</ion-segment>
	</ion-toolbar>
</ion-header>

<ion-content [hidden]="!($availableDevices | async)?.length">
	<span>
		<zxing-scanner
			[formats]="formatsEnabled"
			[device]="$deviceToUse | async"
			[autostart]="true"
			(camerasFound)="onCamerasFound($event)"
			(deviceChange)="onDeviceChange($event)"
			(scanSuccess)="onCodeResult($event)"
			(permissionResponse)="onHasPermission($event)"
			(scanError)="onScanError($event)"
		></zxing-scanner>
	</span>
</ion-content>

<ng-container *appLet="$hasPermissions | async as hasPermission">
	<ng-container *ngIf="hasPermission === undefined">
		<h2>Waiting for permissions.</h2>
		<blockquote>
			If your device does not have cameras, no permissions will be asked.
		</blockquote>
	</ng-container>

	<ng-container *ngIf="hasPermission === false">
		<h2>
			You denied the camera permission, we can't scan anything without it.
			ðŸ˜ª
		</h2>
	</ng-container>

	<ng-container *ngIf="($availableDevices | async) === undefined">
		<h2>Couldn't check for devices.</h2>
		<blockquote>This may be caused by some security error.</blockquote>
	</ng-container>
</ng-container>
